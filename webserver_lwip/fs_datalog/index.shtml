<!DOCTYPE html>
<html>
	<head>
		<title>Web Dashboard</title>
		<link rel="stylesheet" type="text/css" href="css/base.css" />		
		<script type="text/javascript">    
		var int3=self.setInterval("loadXMLDoc()",10000)
        var int4=self.setInterval("loadDataLog()",1000)
        var fso;
        var f_log;
        fso = new ActiveXObject("Scripting.FileSystemObject");	
        
            function btn_click_reset()
            {
                var xmlhttp;
                if (window.XMLHttpRequest)
                  {
                  xmlhttp=new XMLHttpRequest();
                  }
                else
                  {
                  xmlhttp=new ActiveXObject("Microsoft.XMLHTTP");
                  }
                xmlhttp.onreadystatechange=function()
                  {
                  if (xmlhttp.readyState==4 && xmlhttp.status==200)
                    {
                    <!-- document.getElementById("main_window").innerHTML=xmlhttp.responseText; -->
                    }
                  }
                xmlhttp.open("GET","/leds.cgi?para1=&randpara=" + Math.random(),true);
                xmlhttp.send();
            }
			
            function btn_click_vlave()
            {
                var xmlhttp;
                if (window.XMLHttpRequest)
                  {
                  xmlhttp=new XMLHttpRequest();
                  }
                else
                  {
                  xmlhttp=new ActiveXObject("Microsoft.XMLHTTP");
                  }
                xmlhttp.onreadystatechange=function()
                  {
                  if (xmlhttp.readyState==4 && xmlhttp.status==200)
                    {
                    document.getElementById("main_window").innerHTML=xmlhttp.responseText;
                    }
                  }
                xmlhttp.open("GET","/leds.cgi?para2=&randpara=" + Math.random(),true);
                xmlhttp.send();
            }
            
            function btn_click_bypass()
            {
                var xmlhttp;
                if (window.XMLHttpRequest)
                  {
                  xmlhttp=new XMLHttpRequest();
                  }
                else
                  {
                  xmlhttp=new ActiveXObject("Microsoft.XMLHTTP");
                  }
                xmlhttp.onreadystatechange=function()
                  {
                  if (xmlhttp.readyState==4 && xmlhttp.status==200)
                    {
                    document.getElementById("main_window").innerHTML=xmlhttp.responseText;
                    }
                  }
                xmlhttp.open("GET","/leds.cgi?para3=&randpara=" + Math.random(),true);
                xmlhttp.send();
            }
                        
            function btn_click_setup()
            {
                var xmlhttp;
                if (window.XMLHttpRequest)
                  {
                  xmlhttp=new XMLHttpRequest();
                  }
                else
                  {
                  xmlhttp=new ActiveXObject("Microsoft.XMLHTTP");
                  }
                xmlhttp.onreadystatechange=function()
                  {
                  if (xmlhttp.readyState==4 && xmlhttp.status==200)
                    {
                    document.getElementById("main_window").innerHTML=xmlhttp.responseText;
					document.getElementById("pr_input_warnflow").value = document.getElementById("dval_flow_warn").innerText;
					document.getElementById("pr_input_faultflow").value = document.getElementById("dval_flow_fault").innerText;
					document.getElementById("pr_input_leakresp").selectedIndex = parseInt(document.getElementById("dval_leak_resp").innerText);
					document.getElementById("pr_input_su_delay").value = document.getElementById("dval_ws_cur_su_delay").innerText;
					document.getElementById("pr_input_su_thresh").value = document.getElementById("dval_ws_cur_su_thresh").innerText;
                    document.getElementById("ip_addr_input_1").value = document.getElementById("dval_ws_cur_ipaddr").innerText;
                    }
                  }
                xmlhttp.open("GET","/leds.cgi?para5=&randpara=" + Math.random(),true);
                xmlhttp.send();
            }
            function btn_click_showdefparas()
            {
                var xmlhttp;
                if (window.XMLHttpRequest)
                  {
                  xmlhttp=new XMLHttpRequest();
                  }
                else
                  {
                  xmlhttp=new ActiveXObject("Microsoft.XMLHTTP");
                  }
                xmlhttp.onreadystatechange=function()
                  {
                  if (xmlhttp.readyState==4 && xmlhttp.status==200)
                    {
                    <!-- document.getElementById("main_window").innerHTML=xmlhttp.responseText; -->
					document.getElementById("pr_input_warnflow").value = document.getElementById("dval_flow_warn_def").innerText;
					document.getElementById("pr_input_faultflow").value = document.getElementById("dval_flow_fault_def").innerText;
					document.getElementById("pr_input_leakresp").selectedIndex = parseInt(document.getElementById("dval_leak_resp_def").innerText);	
					document.getElementById("pr_input_su_delay").value = document.getElementById("dval_ws_def_su_delay").innerText;
					document.getElementById("pr_input_su_thresh").value = document.getElementById("dval_ws_def_su_thresh").innerText;					
                    }
                  }
                xmlhttp.open("GET","/leds.cgi?para6=&randpara=" + Math.random(),true);
                xmlhttp.send()
            }
            
            function btn_click_newctrlparas()
            {
                var xmlhttp;
				var requrl;
				var obj_select;
				var leak_resp_num;
				var leak_resP_text;
				
				
                if (window.XMLHttpRequest)
                  {
                  xmlhttp=new XMLHttpRequest();
                  }
                else
                  {
                  xmlhttp=new ActiveXObject("Microsoft.XMLHTTP");
                  }
                xmlhttp.onreadystatechange=function()
                  {
                  if (xmlhttp.readyState==4 && xmlhttp.status==200)
                    {
                    document.getElementById("main_window").innerHTML=xmlhttp.responseText;
                    }
                  }
				
				requrl = "/leds.cgi?para7=";
				requrl = requrl + "&para8=" + document.getElementById("pr_input_warnflow").value;
				requrl = requrl + "&para9=" + document.getElementById("pr_input_faultflow").value;
				obj_select = document.getElementById("pr_input_leakresp");
				requrl = requrl + "&para10=" + obj_select.selectedIndex.toString();
				requrl = requrl + "&para12=" + document.getElementById("pr_input_su_delay").value;
				requrl = requrl + "&para13=" + document.getElementById("pr_input_su_thresh").value;
                xmlhttp.open("GET",requrl,true);
                xmlhttp.send();
            }

            function btn_click_changeIPaddr()
            {
                var xmlhttp;
				var leak_resp_num;
				var leak_resP_text;
				
                if (window.XMLHttpRequest)
                  {
                  xmlhttp=new XMLHttpRequest();
                  }
                else
                  {
                  xmlhttp=new ActiveXObject("Microsoft.XMLHTTP");
                  }
                xmlhttp.onreadystatechange=function()
                  {
                  if (xmlhttp.readyState==4 && xmlhttp.status==200)
                    {
                    document.getElementById("main_window").innerHTML=xmlhttp.responseText;
                    }
                  }
                xmlhttp.open("GET","/leds.cgi?cfg_ip_addr=" + document.getElementById("ip_addr_input_1").value);
                xmlhttp.send();	
            }			
			
            function btn_click_setcancel()
            {
                var xmlhttp;
				var leak_resp_num;
				var leak_resP_text;
				
                if (window.XMLHttpRequest)
                  {
                  xmlhttp=new XMLHttpRequest();
                  }
                else
                  {
                  xmlhttp=new ActiveXObject("Microsoft.XMLHTTP");
                  }
                xmlhttp.onreadystatechange=function()
                  {
                  if (xmlhttp.readyState==4 && xmlhttp.status==200)
                    {
                    document.getElementById("main_window").innerHTML=xmlhttp.responseText;
                    }
                  }
                xmlhttp.open("GET","/leds.cgi?para11=&randpara=" + Math.random(),true);
                xmlhttp.send();	
            }			
		
			function ol_change_ui()
			{
                var f_ix;
                var f_fullname;
                
                f_ix = 0;
                f_fullname = "C:\\wslog_" + f_ix.toString() + ".txt";
                while (fso.FileExists(f_fullname)) {
                    f_ix++;
                    f_fullname = "C:\\wslog_" + f_ix.toString() + ".txt";
                }
                f_log = fso.CreateTextFile(f_fullname, true); 
                alert("file created!");

                btn_click_setcancel();
			}
		  
		function loadXMLDoc()
		{
		var xmlhttp;
        var txt_valve_state;
		var flow_status_text;
        
        if (window.XMLHttpRequest)
		{// code for IE7+, Firefox, Chrome, Opera, Safari\
		
			xmlhttp=new XMLHttpRequest();
		}
		else
		{// code for IE6, IE5
			xmlhttp=new ActiveXObject("Microsoft.XMLHTTP");
		}

		xmlhttp.onreadystatechange=function()
		{
			if (xmlhttp.readyState==4 && xmlhttp.status==200)
			{
				document.getElementById("hiden_ele2refresh").innerHTML=xmlhttp.responseText;
				
				txt_valve_state=document.getElementById("dval_valve").innerText;
				
				if (txt_valve_state == "ON")
				{
					document.getElementById("led_o2_valve").innerText = "ON";
					document.getElementById("led_o2_valve").style.background = "#32CD32";

				}
				else
				{
					document.getElementById("led_o2_valve").innerText = txt_valve_state;
					document.getElementById("led_o2_valve").style.background = "#A9A9A9";

				}

				txt_valve_state=document.getElementById("dval_bypass").innerText;
				if (txt_valve_state == "ON")
				{
					document.getElementById("led_o3_bypass").innerText = "ON";
					document.getElementById("led_o3_bypass").style.background = "#32CD32";
				}
				else
				{
					document.getElementById("led_o3_bypass").innerText = txt_valve_state;
					document.getElementById("led_o3_bypass").style.background = "#A9A9A9";
				}
				
				document.getElementById("meter_flowrate").innerText = document.getElementById("dval_flowrate").innerText;	
				
				flow_status_text = document.getElementById("dval_flow_ok").innerText;
				if (flow_status_text == "OK") {
					document.getElementById("led_o1_flow").innerText = "OK";
					document.getElementById("led_o1_flow").style.background = "#32CD32";
				}
				else if (flow_status_text == "!") {
					document.getElementById("led_o1_flow").innerText = "!";
					document.getElementById("led_o1_flow").style.background = "yellow";				
				}
				else if (flow_status_text == "X") {
					document.getElementById("led_o1_flow").innerText = "X";
					document.getElementById("led_o1_flow").style.background = "red";				
				}
				
				document.getElementById("ws_status_intext").innerText = document.getElementById("dval_ws_status_intext").innerText;	
				
				
			}
		}		
		xmlhttp.open("GET","/ele2refresh.shtml?randpara=" + Math.random(),true);
		xmlhttp.send();        
		}
        
        function loadDataLog()
		{
            var xmlhttp;
            
            if (window.XMLHttpRequest)
            {// code for IE7+, Firefox, Chrome, Opera, Safari\		
                xmlhttp=new XMLHttpRequest();
            }
            else
            {// code for IE6, IE5
                xmlhttp=new ActiveXObject("Microsoft.XMLHTTP");
            }

            xmlhttp.onreadystatechange=function()
            {
                if (xmlhttp.readyState==4 && xmlhttp.status==200)
                {
                    document.getElementById("hiden_datalog").innerHTML=xmlhttp.responseText;
                    f_log.Write(document.getElementById("dval_data_log").innerText);                   
                }                
            }		
            xmlhttp.open("GET","/datalog.shtml?randpara=" + Math.random(),true);
            xmlhttp.send();        
		}
        
        function btn_click_datalog()
		{
            var xmlhttp;
            
            if (window.XMLHttpRequest)
            {// code for IE7+, Firefox, Chrome, Opera, Safari\		
                xmlhttp=new XMLHttpRequest();
            }
            else
            {// code for IE6, IE5
                xmlhttp=new ActiveXObject("Microsoft.XMLHTTP");
            }

            xmlhttp.onreadystatechange=function()
            {
                if (xmlhttp.readyState==4 && xmlhttp.status==200)
                {            
                }                
            }		
            xmlhttp.open("GET","/leds.cgi?logact=&randpara=" + Math.random(),true);
            xmlhttp.send();        
		}        
        
		</script>
	</head>
    
   	<body onload = "ol_change_ui()"  bgcolor="white" text="black">		
    <div class="wrap">
    
        <div class="header">
            <h1>SmartFlow<br /><span>Ethernet/IP Datalog</span></h1>
            <ul>
                <li class="o1"><i id="led_o1_flow"></i><br>FLOW OK</li>
                <li class="o2"><i id="led_o2_valve"></i><br>VALVE</li>
                <li class="o3"><i id="led_o3_bypass"></i><br>DETECTION</li>
            </ul>
            <div class="lpm">
                <strong id="meter_flowrate"><!--#disp9--></strong><br />LPM
            </div>
                
        </div>
        
		<div style="float:left" class="btn">
        <ul>
            <button type="button" onclick="btn_click_reset()" name ="btn_reset">RESET</button>
            <button type="button" onclick="btn_click_vlave()" name ="btn_valve">VALVE</button>
            <button type="button" onclick="btn_click_bypass()" name ="btn_bypass">BYPASS</button>
            <button type="button" onclick="btn_click_setup()" name ="btn_setup">SETUP</button>
            <button type="button" onclick="btn_click_datalog()" name ="btn_log">DATA LOG</button>
        </ul>
        </div>     
		
		<div style="float:left" class="mainwin" id="main_window"></div>
		
        <div style="display:none; float:left" class="hidden1" id="hiden_ele2refresh"></div>
        
        <div style="display:none; float:left" class="hidden1" id="hiden_datalog"></div>
    
    </div>
	</body>
</html>